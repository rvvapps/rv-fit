<!DOCTYPE html>
<html lang="es">
<head>
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<meta charset="UTF-8">
<title>Entrenamientos RV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="RV FIT">

<style>
/* SPLASH SCREEN */
#splash{
  position:fixed;
  inset:0;
  background:#f8fafc;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  opacity:1;
}


#splash img{
  width:140px;
  height:140px;
  border-radius:28px;
  box-shadow:0 12px 32px rgba(0,0,0,.18);
  animation:scaleIn .4s ease forwards;
}

#splash.hide{
  animation:fadeOut .5s ease forwards;
}

@keyframes fadeIn{
  from{opacity:0}
  to{opacity:1}
}

@keyframes fadeOut{
  from{opacity:1}
  to{opacity:0}
}

@keyframes scaleIn{
  from{transform:scale(.92)}
  to{transform:scale(1)}
}

  :root{
  --primary:#2563eb;
  --scheduled:#fde68a;
  --done:#22c55e;
  --bg:#f8fafc;
  --border:#cbd5e1;
  --weekend:#e5e7eb;
}

body{
  margin:0;
  font-family:system-ui,-apple-system,sans-serif;
  background:var(--bg);
  padding:.75rem;
}

.container{
  max-width:420px;
  margin:auto;
  background:#fff;
  padding:.75rem;
  border-radius:18px;
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}

header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:.4rem .2rem;
  border-bottom:1px solid var(--border);
  margin-bottom:.5rem;
}

.app-icon{ width:34px; height:34px; }

h1{
  font-size:1rem;
  margin:0;
}
.subtitle{
  font-size:.65rem;
  color:#64748b;
}

.nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:.4rem 0;
}

button,input{
  font-size:.75rem;
  padding:.35rem;
  border-radius:8px;
  border:1px solid var(--border);
  background:#fff;
}

.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
}

.day-name{
  text-align:center;
  font-size:.65rem;
  font-weight:600;
}

.day{
  min-height:56px;
  border:1px solid var(--border);
  border-radius:10px;
  text-align:center;
  padding:.25rem;
  cursor:pointer;
  position:relative;
}

.day.weekend{ background:var(--weekend); }

.day.selected{
  border:2px solid var(--primary);
  box-shadow:0 0 0 2px rgba(37,99,235,.15);
}

.day.scheduled{ background:var(--scheduled); }

.day.done{
  background:var(--done);
  color:white;
}
.day.done::after{
  content:"‚úî";
  position:absolute;
  top:4px;
  right:6px;
  font-size:.75rem;
}

.day .num{ font-size:.85rem; font-weight:600; }
.day .time{ font-size:.65rem; }

.empty{ visibility:hidden; }

.section{ margin-top:.6rem; }

.toggle{
  display:flex;
  align-items:center;
  gap:6px;
  cursor:pointer;
  font-size:.75rem;
  font-weight:600;
}

.times{
  display:none;
  gap:4px;
  flex-wrap:wrap;
  margin-top:.3rem;
}
.times.show{ display:flex; }

.progress{
  margin-top:.6rem;
}

.progress.hidden{ display:none; }

.progress-label{
  font-size:.75rem;
  display:flex;
  justify-content:space-between;
}

.bar{
  height:8px;
  background:#e5e7eb;
  border-radius:6px;
  overflow:hidden;
}

.fill{
  height:100%;
  background:var(--primary);
  transition:width .4s ease;
}

.total{
  margin-top:.4rem;
  font-size:.75rem;
  text-align:center;
  font-weight:600;
}

/* Vista anual */
.year{
  margin-top:.7rem;
}

.year-view{
  display:none;
  justify-content:space-between;
  margin-top:.4rem;
}

.year-view.show{ display:flex; }

.month{
  width:26px;
  text-align:center;
  font-size:.6rem;
  opacity:.5;
}
.month.active{
  opacity:1;
  font-weight:600;
}

.month-bar{
  height:5px;
  background:#e5e7eb;
  border-radius:3px;
  overflow:hidden;
  display:flex;
  margin:.15rem 0;
}

.m-done{ background:var(--done); }
.m-sched{ background:var(--scheduled); }

footer{
  margin-top:.6rem;
  display:flex;
  justify-content:center;
}
</style>
</head>

<body>
<div id="splash">
  <img src="splash.png" alt="RV FIT">
</div>
<div class="container">

<header>
  <svg class="app-icon" viewBox="0 0 100 100">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#2563eb"/>
        <stop offset="100%" stop-color="#22c55e"/>
      </linearGradient>
    </defs>
    <rect width="100" height="100" rx="20" fill="url(#g)"/>
    <text x="50" y="62" font-size="42" fill="white" text-anchor="middle" font-weight="700">RV</text>
  </svg>
  <div>
    <h1>Entrenamientos</h1>
    <div class="subtitle">Constancia &gt; intensidad</div>
  </div>
  <div></div>
</header>

<div class="nav">
  <button id="prev">‚óÄ</button>
  <strong id="monthLabel"></strong>
  <button id="next">‚ñ∂</button>
</div>

<div class="calendar"></div>

<div class="section">
  <div class="toggle" onclick="toggleTimes()">‚è∞ Programar horario</div>
  <div class="times" id="times">
    <button onclick="setTime('06:30')">06:30</button>
    <button onclick="setTime('07:00')">07:00</button>
    <button onclick="setTime('07:30')">07:30</button>
    <input type="time" id="custom">
    <button onclick="setCustom()">OK</button>
    <button onclick="setTime('--:--')">Sin hora</button>
  </div>
</div>

<div id="progressSection">
  <div class="progress">
    <div class="progress-label">
      <span>Semana actual (meta 3)</span>
      <span id="weekGoal"></span>
    </div>
    <div class="bar"><div class="fill" id="weekFill"></div></div>
  </div>

  <div class="progress">
    <div class="progress-label">
      <span>Mes</span>
      <span id="monthGoal"></span>
    </div>
    <div class="bar"><div class="fill" id="monthFill"></div></div>
  </div>

  <div class="total" id="monthTotal"></div>
</div>

<div class="year">
  <button onclick="toggleYear()">üìä Vista anual</button>
  <div class="year-view" id="yearView"></div>
</div>

<footer>
  <button onclick="resetAll()">Reiniciar todo</button>
</footer>

</div>

<script>
const STORAGE="rv-entrenos";
const WEEK_GOAL=3;

let data=JSON.parse(localStorage.getItem(STORAGE)||"{}");
let current=new Date();
let selected=null;

const cal=document.querySelector(".calendar");
const label=document.getElementById("monthLabel");
const weekFill=document.getElementById("weekFill");
const monthFill=document.getElementById("monthFill");
const weekGoal=document.getElementById("weekGoal");
const monthGoal=document.getElementById("monthGoal");
const monthTotal=document.getElementById("monthTotal");
const yearView=document.getElementById("yearView");
const progressSection=document.getElementById("progressSection");

const dayNames=["L","M","M","J","V","S","D"];
const months=["E","F","M","A","M","J","J","A","S","O","N","D"];

function save(){localStorage.setItem(STORAGE,JSON.stringify(data));}

function render(){
  cal.innerHTML="";
  dayNames.forEach(d=>cal.innerHTML+=`<div class="day-name">${d}</div>`);

  let y=current.getFullYear(), m=current.getMonth();
  label.textContent=`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][m]} ${y}`;

  let first=new Date(y,m,1).getDay()||7;
  let total=new Date(y,m+1,0).getDate();

  for(let i=1;i<first;i++) cal.innerHTML+='<div class="empty"></div>';

  for(let d=1;d<=total;d++){
    let key=`${y}-${m}-${d}`;
    let date=new Date(y,m,d);
    let cell=document.createElement("div");
    cell.className="day";

    if(date.getDay()===0||date.getDay()===6) cell.classList.add("weekend");
    if(key===selected) cell.classList.add("selected");

cell.onclick=()=>{
  // fecha de hoy
  const today = new Date();
  today.setHours(0,0,0,0);

  // fecha del d√≠a clickeado
  const clickedDate = new Date(y, m, d);
  clickedDate.setHours(0,0,0,0);

  // üîí bloqueo: no permitir marcar como hecho en el futuro
  if(
    selected === key &&
    data[key] &&
    !data[key].done &&
    clickedDate > today
  ){
    alert("‚è≥ Este entrenamiento a√∫n no ocurre");
    return;
  }

  if(selected===key && data[key]){
    data[key].done = !data[key].done;
    save();
  }

  selected = key;
  render();
};
    if(data[key]){
      cell.classList.add(data[key].done?"done":"scheduled");
      cell.innerHTML=`<div class="num">${d}</div><div class="time">${data[key].time}</div>`;
    } else {
      cell.innerHTML=`<div class="num">${d}</div>`;
    }

    cal.appendChild(cell);
  }

  updateStats();
  renderYear();
}

function updateStats(){
  let today=new Date();
  let isCurrentMonth=
    current.getMonth()===today.getMonth() &&
    current.getFullYear()===today.getFullYear();

  progressSection.style.display=isCurrentMonth?"block":"none";
  if(!isCurrentMonth) return;

  today.setHours(0,0,0,0);
  let ws=new Date(today);
  ws.setDate(ws.getDate()-((ws.getDay()+6)%7));

  let wDone=0,mDone=0,mTotal=0;

  Object.keys(data).forEach(k=>{
    let [yy,mm,dd]=k.split("-").map(Number);
    let d=new Date(yy,mm,dd); d.setHours(0,0,0,0);
    if(d>today) return;

    if(d>=ws && data[k].done) wDone++;
    if(yy===current.getFullYear() && mm===current.getMonth()){
      mTotal++;
      if(data[k].done) mDone++;
    }
  });

  weekFill.style.width=Math.min(100,(wDone/WEEK_GOAL)*100)+"%";
  weekGoal.textContent=`${wDone} / ${WEEK_GOAL} ${wDone>=WEEK_GOAL?"üî•":"üèÉ‚Äç‚ôÇÔ∏è"}`;

  let pct=mTotal?Math.round((mDone/mTotal)*100):0;
  monthFill.style.width=pct+"%";
  monthGoal.textContent=`${mDone} / ${mTotal} ${mDone>=mTotal && mTotal>0?"üí™":"üèÉ‚Äç‚ôÇÔ∏è"} ¬∑ ${pct}%`;
  monthTotal.textContent=`Total entrenamientos mes: ${mTotal}`;
}

function renderYear(){
  yearView.innerHTML="";
  let y=current.getFullYear();

  for(let m=0;m<12;m++){
    let done=0,sched=0;
    Object.keys(data).forEach(k=>{
      let [yy,mm]=k.split("-").map(Number);
      if(yy===y && mm===m){
        sched++;
        if(data[k].done) done++;
      }
    });

    let el=document.createElement("div");
    el.className="month";
    if(m===current.getMonth()) el.classList.add("active");

    el.innerHTML=`
      <div>${months[m]}</div>
      <div class="month-bar">
        <div class="m-done" style="width:${done*2}px"></div>
        <div class="m-sched" style="width:${(sched-done)*2}px"></div>
      </div>
      <div>${done}/${sched||0}</div>`;
    yearView.appendChild(el);
  }
}

function toggleTimes(){document.getElementById("times").classList.toggle("show");}
function toggleYear(){yearView.classList.toggle("show");}

function setTime(time){
  if(!selected) return alert("Selecciona un d√≠a");
  if(!data[selected]) data[selected]={time,done:false};
  else data[selected].time=time;
  save(); render();
}
function setCustom(){
  let t=document.getElementById("custom").value;
  if(t) setTime(t);
}

function resetAll(){
  if(confirm("¬øBorrar todo el calendario?")){
    data={}; selected=null; save(); render();
  }
}

document.getElementById("prev").onclick=()=>{current.setMonth(current.getMonth()-1);render();}
document.getElementById("next").onclick=()=>{current.setMonth(current.getMonth()+1);render();}

render();
</script>
<script>
window.addEventListener("load", () => {

  // Registrar Service Worker
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js")
      .then(() => console.log("Service Worker OK"))
      .catch(err => console.error("SW error", err));
  }

  // Splash screen fade out
  const splash = document.getElementById("splash");
  if (splash) {
    setTimeout(() => {
      splash.classList.add("hide");
      setTimeout(() => splash.remove(), 500);
    }, 2000);
  }

});
</script>


</body>
</html>







